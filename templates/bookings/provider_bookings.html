{% extends 'base.html' %}
{% load static %}

{% block title %}Agendamentos dos Clientes{% endblock %}

{% block content %}
<h2 class="mb-3">Agendamentos dos Clientes</h2>

<div class="card mb-3">
  <div class="card-body">
    <form method="get" class="row g-2">
      <div class="col-auto">
        <select name="status" class="form-select">
          <option value="">Todos os status</option>
          <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pendente</option>
          <option value="confirmed" {% if status_filter == 'confirmed' %}selected{% endif %}>Confirmado</option>
          <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Cancelado</option>
          <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Concluído</option>
        </select>
      </div>
      <div class="col-auto">
        <button class="btn btn-secondary" type="submit">Filtrar</button>
        <a class="btn btn-outline-secondary" href="{% url 'provider_bookings' %}">Limpar</a>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Data</th>
            <th>Horário</th>
            <th>Cliente</th>
            <th>Email</th>
            <th>Telefone</th>
            <th>Status</th>
            <th>Agendado em</th>
          </tr>
        </thead>
        <tbody>
          {% for b in bookings %}
            <tr>
              <td>{{ b.time_slot.date|date:"d/m/Y" }}</td>
              <td>{{ b.time_slot.start_time }} - {{ b.time_slot.end_time }}</td>
              <td>{{ b.user.get_full_name|default:b.user.username }}</td>
              <td><a href="mailto:{{ b.user.email }}">{{ b.user.email }}</a></td>
              <td>{{ b.user.phone|default:"—" }}</td>
              <td>
                {% if b.status == 'pending' %}
                  <span class="badge bg-warning text-dark">Pendente</span>
                {% elif b.status == 'confirmed' %}
                  <span class="badge bg-success">Confirmado</span>
                {% elif b.status == 'cancelled' %}
                  <span class="badge bg-danger">Cancelado</span>
                {% elif b.status == 'completed' %}
                  <span class="badge bg-secondary">Concluído</span>
                {% endif %}
              </td>
              <td class="text-muted small">{{ b.created_at|date:"d/m/Y H:i" }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="7" class="text-center text-muted">Nenhum agendamento encontrado.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if is_paginated %}
      <nav>
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">Anterior</a></li>
          {% endif %}
          <li class="page-item disabled"><span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span></li>
          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">Próxima</a></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>
</div>
{% endblock %}